name: Sync master from Manjaro GitLab

# Trigger: manuálisan és naponta 05:00 UTC-kor
on:
  workflow_dispatch:
  schedule:
    - cron: '0 5 * * *'

jobs:
  sync:
    runs-on: ubuntu-latest

    steps:
      # 1️⃣ Checkout a repo
      - name: Checkout GitHub repo
        uses: actions/checkout@v4
        with:
          fetch-depth: 0  # teljes history kell

      # 2️⃣ GitLab remote hozzáadása
      - name: Add GitLab remote
        run: |
          git remote add gitlab https://gitlab.manjaro.org/profiles-and-settings/iso-profiles.git
          git fetch gitlab

      # 3️⃣ Reset master a GitLab masterre
      - name: Reset master to GitLab master
        run: |
          git checkout master
          git reset --hard gitlab/master

      # 4️⃣ Push GitHubra PAT-al
      - name: Push to GitHub using PAT
        env:
          GH_PAT: ${{ secrets.GH_PAT }}
        run: |
          # Távolítsuk el a newline karaktereket
          GH_PAT_CLEAN=$(echo -n "$GH_PAT" | tr -d '\n')
          git remote set-url origin "https://x-access-token:${GH_PAT_CLEAN}@github.com/megvadulthangya/iso-profiles.git"
          git push origin master --force

