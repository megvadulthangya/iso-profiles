#!/bin/bash
# --- SNAPPER TELEP√çT√âS √âS TAKAR√âKOS KONFIGUR√ÅCI√ì (root + home) MANJARO-HOZ ---
# BTRFS karbantart√°s btrfsmaintenance csomaggal

# 1. Root jogosults√°g ellen≈ërz√©se
if [[ $EUID -ne 0 ]]; then
   echo "Hiba: Ezt a szkriptet root-k√©nt kell futtatni (sudo haszn√°lat√°val)"
   exit 1
fi

# 2. Snapper √©s snap-pac elt√°vol√≠t√°sa
echo "R√©gi csomagok elt√°vol√≠t√°sa..."
pacman -R --noconfirm snap-pac snapper 2>/dev/null || true

# 3. K√∂nyvt√°rak l√©trehoz√°sa
echo "Konfigur√°ci√≥s k√∂nyvt√°rak l√©trehoz√°sa..."
mkdir -p /etc/snapper/configs
mkdir -p /etc/conf.d

# 4. /etc/conf.d/snapper
cat > /etc/conf.d/snapper << 'EOF'
SNAPPER_CONFIGS="root home"
EOF

# 5. ROOT konfigur√°ci√≥
cat > /etc/snapper/configs/root << 'EOF'
SUBVOLUME="/"
FSTYPE="btrfs"
QGROUP=""
SPACE_LIMIT="0.5"
FREE_LIMIT="0.2"
ALLOW_USERS=""
ALLOW_GROUPS=""
SYNC_ACL="no"
BACKGROUND_COMPARISON="yes"
NUMBER_CLEANUP="yes"
NUMBER_MIN_AGE="1800"
NUMBER_LIMIT="10"
NUMBER_LIMIT_IMPORTANT="10"
TIMELINE_CREATE="no"
TIMELINE_CLEANUP="yes"
TIMELINE_MIN_AGE="1800"
TIMELINE_LIMIT_HOURLY="10"
TIMELINE_LIMIT_DAILY="10"
TIMELINE_LIMIT_WEEKLY="0"
TIMELINE_LIMIT_MONTHLY="10"
TIMELINE_LIMIT_QUARTERLY="0"
TIMELINE_LIMIT_YEARLY="10"
EMPTY_PRE_POST_CLEANUP="yes"
EMPTY_PRE_POST_MIN_AGE="1800"
EOF

# 6. HOME konfigur√°ci√≥
if [ ! -d /home/.snapshots ]; then
    echo "/home/.snapshots subvolume l√©trehoz√°sa..."
    btrfs subvolume create /home/.snapshots
fi

cat > /etc/snapper/configs/home << 'EOF'
SUBVOLUME="/home"
FSTYPE="btrfs"
QGROUP=""
SPACE_LIMIT="0.5"
FREE_LIMIT="0.2"
ALLOW_USERS=""
ALLOW_GROUPS=""
SYNC_ACL="no"
BACKGROUND_COMPARISON="yes"
NUMBER_CLEANUP="yes"
NUMBER_MIN_AGE="1800"
NUMBER_LIMIT="10"
NUMBER_LIMIT_IMPORTANT="10"
TIMELINE_CREATE="no"
TIMELINE_CLEANUP="yes"
TIMELINE_MIN_AGE="1800"
TIMELINE_LIMIT_HOURLY="10"
TIMELINE_LIMIT_DAILY="10"
TIMELINE_LIMIT_WEEKLY="0"
TIMELINE_LIMIT_MONTHLY="10"
TIMELINE_LIMIT_QUARTERLY="0"
TIMELINE_LIMIT_YEARLY="10"
EMPTY_PRE_POST_CLEANUP="yes"
EMPTY_PRE_POST_MIN_AGE="1800"
EOF

echo "‚úì Root √©s Home konfigur√°ci√≥k l√©trehozva"

# 7. Snapper √∫jratelep√≠t√©se
echo "Snapper √∫jratelep√≠t√©se..."
pacman -S --noconfirm snapper

# 8. Snap-pac √∫jratelep√≠t√©se (pacman hook-okhoz)
echo "Snap-pac √∫jratelep√≠t√©se..."
pacman -S --noconfirm snap-pac

# 9. /.snapshots JAV√çTOTT ellen≈ërz√©se
SNAPSHOTS_DIR="/.snapshots"
if [ ! -d "$SNAPSHOTS_DIR" ]; then
    echo ".snapshots subvolume l√©trehoz√°sa..."
    btrfs subvolume create "$SNAPSHOTS_DIR"
    echo "‚úì /.snapshots subvolume l√©trehozva"
else
    echo "‚úì /.snapshots subvolume m√°r l√©tezik"
fi

# Dupla perjel ellen≈ërz√©se √©s jav√≠t√°sa (ha sz√ºks√©ges)
if [[ "$SNAPSHOTS_DIR" == "//"* ]]; then
    SNAPSHOTS_DIR="${SNAPSHOTS_DIR#/}"
    echo "Figyelmeztet√©s: Dupla perjel jav√≠tva: $SNAPSHOTS_DIR"
fi

# 10. Szolg√°ltat√°sok ind√≠t√°sa (de timeline timer n√©lk√ºl)
echo "Szolg√°ltat√°sok ind√≠t√°sa..."
systemctl enable --now snapperd
systemctl disable --now snapper-timeline.timer 2>/dev/null || true
systemctl enable --now snapper-cleanup.timer

# 11. BTRFS MAINTENANCE - EGYSZER≈∞BB MEGOLD√ÅS
echo "[+] BTRFS karbantart√°s konfigur√°l√°sa btrfsmaintenance csomaggal..."

# btrfsmaintenance csomag telep√≠t√©se
pacman -S --noconfirm btrfsmaintenance

# Konfigur√°ci√≥s f√°jl l√©trehoz√°sa
cat > /etc/default/btrfsmaintenance << 'EOF'
# BTRFS karbantart√°si be√°ll√≠t√°sok
BTRFS_LOG_OUTPUT="stdout"

# Defrag be√°ll√≠t√°sok
BTRFS_DEFRAG_PATHS="auto"
BTRFS_DEFRAG_PERIOD="weekly"
BTRFS_DEFRAG_MIN_SIZE="+1M"

# Balance be√°ll√≠t√°sok
BTRFS_BALANCE_MOUNTPOINTS="auto"
BTRFS_BALANCE_PERIOD="monthly"
BTRFS_BALANCE_DUSAGE="5 10"
BTRFS_BALANCE_MUSAGE="5"

# Scrub be√°ll√≠t√°sok
BTRFS_SCRUB_MOUNTPOINTS="auto"
BTRFS_SCRUB_PERIOD="weekly"
BTRFS_SCRUB_PRIORITY="idle"
BTRFS_SCRUB_READ_ONLY="false"

# Trim be√°ll√≠t√°sok
BTRFS_TRIM_PERIOD="weekly"
BTRFS_TRIM_MOUNTPOINTS="auto"

# Egy√©b be√°ll√≠t√°sok
BTRFS_ALLOW_CONCURRENCY="false"
EOF

# Szolg√°ltat√°sok aktiv√°l√°sa
systemctl enable --now btrfs-scrub@.timer
systemctl enable --now btrfs-balance@.timer  
systemctl enable --now btrfs-trim@.timer
systemctl enable --now btrfs-defrag@.timer

echo "[‚úî] BTRFS karbantart√°s akt√≠v btrfsmaintenance konfigur√°ci√≥val."

# 12. Teszt √©s ellen≈ërz√©s
echo "V√©gs≈ë ellen≈ërz√©s..."
sleep 2

echo "Konfigur√°ci√≥k list√°ja:"
snapper list-configs

echo "Teszt snapshot l√©trehoz√°sa ROOT alatt..."
if snapper -c root create --description "teszt_root" 2>/dev/null; then
    echo "‚úì Root snapshot l√©trej√∂tt."
else
    echo "‚ö† Root snapshot nem k√©sz√ºlt (ellen≈ërizd a jogosults√°gokat)."
fi

echo "Teszt snapshot l√©trehoz√°sa HOME alatt..."
if snapper -c home create --description "teszt_home" 2>/dev/null; then
    echo "‚úì Home snapshot l√©trej√∂tt."
else
    echo "‚ö† Home snapshot nem k√©sz√ºlt (ellen≈ërizd a jogosults√°gokat)."
fi

echo "BTRFS timer-ek √°llapota:"
systemctl list-timers | grep btrfs

echo
echo "‚úÖ K√âSZ! A Snapper most takar√©kos m√≥dban m≈±k√∂dik (k√©zi + pacman snapshotok)."
echo "‚úÖ BTRFS karbantart√°s akt√≠v btrfsmaintenance konfigur√°ci√≥val."
echo "üìù Be√°ll√≠t√°sok m√≥dos√≠that√≥k: /etc/default/btrfsmaintenance"


# ================================================================
#                EGYES√çTETT TELEP√çT≈ê √âS KONFIGUR√ÅL√ì SCRIPT
# ================================================================
# Ez a script root jogosults√°gokkal fut, de a felhaszn√°l√≥-specifikus
# m≈±veleteket (pl. AUR telep√≠t√©s) az eredeti felhaszn√°l√≥ nev√©ben v√©gzi.
# ================================================================

# --- Logol√°s be√°ll√≠t√°sa ---
# A script minden kimenete a k√©perny≈ëre √âS egy d√°tumozott log f√°jlba ker√ºl.
INSTALL_LOG="install_$(date +%Y%m%d_%H%M%S).log"
exec > >(tee -a "$INSTALL_LOG") 2>&1

# Hibakezel√©s be√°ll√≠t√°sa: A script kil√©p, ha egy parancs hib√°val t√©r vissza.
set -euo pipefail

echo ""
echo "--- A TELEP√çT√âS ELKEZD≈êD√ñTT ---"
echo "Minden m≈±velet a k√∂vetkez≈ë f√°jlba lesz napl√≥zva: $INSTALL_LOG"
echo ""


if [ "$(id -u)" -ne "0" ]; then
  echo "Ez a script root jogosults√°gokat ig√©nyel. Futtassa sudo-val vagy root-k√©nt."
  exit 1
fi

# Felhaszn√°l√≥ √©s home k√∂nyvt√°r meghat√°roz√°sa
if [ -n "${SUDO_USER:-}" ]; then
    USERNAME="$SUDO_USER"
else
    USERNAME=$(logname 2>/dev/null || echo "$(whoami)")
fi

USER_HOME=$(getent passwd "$USERNAME" | cut -d: -f6)

if [ -z "$USER_HOME" ]; then
    echo "Hiba: Nem tal√°lhat√≥ a(z) '$USERNAME' felhaszn√°l√≥ home k√∂nyvt√°ra."
    exit 1
fi

echo "Felhaszn√°l√≥: $USERNAME"
echo "Felhaszn√°l√≥ home: $USER_HOME"

# 1. PAMAC ELLEN≈êRZ√âSE √âS BE√ÅLL√çT√ÅSA (Manjaro specifikus)
if command -v pamac &> /dev/null; then
    echo "Pamac telep√≠tve. Pamac konfigur√°ci√≥ ellen≈ërz√©se..."
    
    CONFIG_FILE="/etc/pamac.conf"
    AUR_SETTING="EnableAUR"

    if grep -q "^${AUR_SETTING}" "$CONFIG_FILE"; then
        echo "‚úÖ Pamac AUR t√°mogat√°s: M√°r enged√©lyezve."
    else
        if grep -q "^#${AUR_SETTING}" "$CONFIG_FILE"; then
            echo "‚ö†Ô∏è Pamac AUR t√°mogat√°s: Tiltva. Enged√©lyez√©s..."
            sed -i "/^#${AUR_SETTING}/s/^#//g" "$CONFIG_FILE"
            echo "‚úÖ Pamac AUR t√°mogat√°s: Sikeresen enged√©lyezve."
        else
            echo "‚ùå Hiba: Az '${AUR_SETTING}' be√°ll√≠t√°s form√°tuma nem megfelel≈ë a(z) '${CONFIG_FILE}' f√°jlban."
        fi
    fi
    
    pamac update --force-refresh
    echo "Pamac adatb√°zisok friss√≠tve."
else
    echo "Pamac nem tal√°lhat√≥. Egy√©b AUR seg√≠t≈ëk ellen≈ërz√©se..."
    
    if command -v yay &> /dev/null; then
        echo "Yay telep√≠tve. Az AUR alap√©rtelmezetten el√©rhet≈ë a 'yay' paranccsal."
    elif command -v paru &> /dev/null; then
        echo "Paru telep√≠tve. Az AUR alap√©rtelmezetten el√©rhet≈ë a 'paru' paranccsal."
    else
        echo "Nincs telep√≠tett Pamac, Yay vagy Paru. K√©zi AUR seg√©d telep√≠t√©s sz√ºks√©ges."
    fi
fi

# --- Csomagkezel≈ë autodetekt√°l√°s ---
if command -v pamac &>/dev/null; then
    PKG_MGR="pamac"
elif command -v paru &>/dev/null; then
    PKG_MGR="paru"
elif command -v yay &>/dev/null; then
    PKG_MGR="yay"
elif command -v pacman &>/dev/null; then
    PKG_MGR="pacman"
else
    echo "Nem tal√°lhat√≥ t√°mogatott csomagkezel≈ë (pacman/pamac/yay/paru)."
    exit 1
fi

echo "Haszn√°lt csomagkezel≈ë: $PKG_MGR"

# --- F√ºggv√©nyek ---
install_repo() {
    pacman -S --needed --noconfirm "$@"
}

install_aur() {
    case "$PKG_MGR" in
        pamac)
            sudo -u "$USERNAME" pamac install --no-confirm "$@"
            ;;
        yay|paru)
            sudo -u "$USERNAME" $PKG_MGR -S --needed --noconfirm "$@"
            ;;
        pacman)
            echo "Figyelem: AUR csomagok telep√≠t√©s√©hez nincs AUR helper telep√≠tve."
            ;;
    esac
}

# --- Repo csomagok ---
REPO_PKGS=(
  dmenu rofi flameshot picom scrot unclutter xorg-xbacklight alsa-utils mpd mpc playerctl xorg-fonts-misc ttf-roboto woff2-font-awesome arandr lxappearance xorg-xev terminus-font xss-lock wavemon network-manager-applet feh qt6ct geany ttf-firacode-nerd fish starship bat eza jq fzf nano-syntax-highlighting noto-fonts-emoji
)

echo "Repo csomagok telep√≠t√©se..."
install_repo "${REPO_PKGS[@]}"

# --- AUR csomagok ---
AUR_PKGS=(
  raw-thumbnailer grayjay-bin gsconnect lain-git awesome-git awesome-freedesktop-git tilix-git ttf-font-awesome-5 tamzen-font i3lock-fancy-git betterlockscreen nordic-theme nordic-darker-theme nordic-darker-standard-buttons-theme nordic-polar-standard-buttons-theme nordic-standard-buttons-theme nordic-bluish-accent-theme nordic-bluish-accent-standard-buttons-theme geany-nord-theme nordzy-icon-theme nordic-wallpapers-git oh-my-posh-bin fish-done find-the-command p7zip-gui
)

echo "AUR csomagok telep√≠t√©se..."
install_aur "${AUR_PKGS[@]}"

# --- Ikon font telep√≠t√©se ---
echo "Ikon font telep√≠t√©se $USERNAME sz√°m√°ra..."
sudo -u "$USERNAME" mkdir -p "$USER_HOME/.local/share/fonts"
sudo -u "$USERNAME" curl -fL -o "$USER_HOME/.local/share/fonts/Icons.bdf" \
  https://raw.githubusercontent.com/lcpz/dots/refs/heads/master/.fonts/Icons.bdf

echo "Removing inappropriate wallpapers from nordic-wallpapers-git ..."
rm -f /usr/share/backgrounds/nordic-wallpapers-git/artix-nord.png \
      /usr/share/backgrounds/nordic-wallpapers-git/debian.png \
      /usr/share/backgrounds/nordic-wallpapers-git/debian-galaxy.png \
      /usr/share/backgrounds/nordic-wallpapers-git/elementaryos.png \
      /usr/share/backgrounds/nordic-wallpapers-git/fedora.png \
      /usr/share/backgrounds/nordic-wallpapers-git/gnu-linux.png \
      /usr/share/backgrounds/nordic-wallpapers-git/ign_endeavour1.png \
      /usr/share/backgrounds/nordic-wallpapers-git/ign_endeavour2.png \
      /usr/share/backgrounds/nordic-wallpapers-git/ign_endeavour3.png \
      /usr/share/backgrounds/nordic-wallpapers-git/ign_endeavour4.png \
      /usr/share/backgrounds/nordic-wallpapers-git/ign-hevlettpackard.png \
      /usr/share/backgrounds/nordic-wallpapers-git/ign_windows_11.png \
      /usr/share/backgrounds/nordic-wallpapers-git/ign_zorin.png \
      /usr/share/backgrounds/nordic-wallpapers-git/Minimal-Nord.png \
      /usr/share/backgrounds/nordic-wallpapers-git/nixos.png \
      /usr/share/backgrounds/nordic-wallpapers-git/nordic-obsession.png \
      /usr/share/backgrounds/nordic-wallpapers-git/nordtheme.png \
      /usr/share/backgrounds/nordic-wallpapers-git/nord_triangles.png \
      /usr/share/backgrounds/nordic-wallpapers-git/openbsd.png \
      /usr/share/backgrounds/nordic-wallpapers-git/opensuse.png \
      /usr/share/backgrounds/nordic-wallpapers-git/rocket.png \
      /usr/share/backgrounds/nordic-wallpapers-git/slackware.png \
      /usr/share/backgrounds/nordic-wallpapers-git/ubuntu-aurora.png \
      /usr/share/backgrounds/nordic-wallpapers-git/ubuntu-frost.png \
      /usr/share/backgrounds/nordic-wallpapers-git/voidlinux.png \
      /usr/share/backgrounds/nordic-wallpapers-git/voidlinux-01.png

echo "Telep√≠t√©s befejezve!"

# ------------------------------------------------------
# Adi1090x Rofi t√©m√°k telep√≠t√©se
# ------------------------------------------------------
echo "[INFO] Rofi t√©m√°k telep√≠t√©se a megvadulthangya forkj√°b√≥l..."

if [ -n "$SUDO_USER" ]; then
    USER_HOME=$(getent passwd "$SUDO_USER" | cut -d: -f6)

    runuser -l "$SUDO_USER" -c '
        echo "[INFO] Rofi t√©m√°k let√∂lt√©se a GitHubr√≥l...";
        cd /tmp;
        rm -rf rofi;
        git clone --depth=1 -b my-awesome-config https://github.com/megvadulthangya/Awesome-rofi.git rofi;
        cd rofi;
        echo "[INFO] Bet≈±t√≠pusok telep√≠t√©se...";
        FONT_DIR="$HOME/.local/share/fonts";
        mkdir -p "$FONT_DIR";
        cp -rf fonts/* "$FONT_DIR";
        
        echo "[INFO] Bet≈±t√≠pus gyors√≠t√≥t√°r friss√≠t√©se...";
        fc-cache -f -v;
        
        ROFI_DIR="$HOME/.config/rofi";
        if [[ -d "$ROFI_DIR" ]]; then
            echo "[INFO] Megl√©v≈ë Rofi konfigur√°ci√≥ biztons√°gi ment√©se ide: ${ROFI_DIR}.bak";
            mv "$ROFI_DIR" "${ROFI_DIR}.bak";
        fi
        
        echo "[INFO] Rofi t√©m√°k telep√≠t√©se...";
        mkdir -p "$ROFI_DIR";
        cp -rf files/* "$ROFI_DIR";
        
        echo "[SUCCESS] Rofi t√©m√°k sikeresen telep√≠tve.";
    '
    
    echo "[INFO] Ideiglenes f√°jlok t√∂rl√©se..."
    rm -rf /tmp/rofi
    
else
    echo "[HIBA] A scriptet sudo-val kell futtatni, hogy a felhaszn√°l√≥i be√°ll√≠t√°sokat elv√©gezhesse!"
    echo "[HIBA] A Rofi t√©m√°k telep√≠t√©se kimarad."
fi

echo "[INFO] Rofi t√©ma telep√≠t√©se k√©sz."

# --- Nano Syntax Highlighting ---
INSTALL_PATH="/usr/share/nano-syntax-highlighting"

echo "=== Nano Syntax Highlighting telep√≠t√©se system-wide ==="
if [ ! -d "$INSTALL_PATH" ]; then
    git clone https://github.com/scopatz/nanorc.git "$INSTALL_PATH"
fi

if [ -f /etc/nanorc ]; then
    cp /etc/nanorc /etc/nanorc.backup.$(date +%F_%H-%M-%S)
fi

if ! grep -q "include $INSTALL_PATH/*.nanorc" /etc/nanorc 2>/dev/null; then
    echo "include $INSTALL_PATH/*.nanorc" >> /etc/nanorc
fi

echo "=== K√©sz! System-wide szintaxis kiemel√©s be√°ll√≠tva. ==="

# --- Nano mint alap√©rtelmezett szerkeszt≈ë ---
echo "A 'nano' be√°ll√≠t√°sa alap√©rtelmezett sz√∂vegszerkeszt≈ënek..."
echo "export EDITOR=nano" | tee -a /etc/environment
echo "nano be√°ll√≠tva alap√©rtelmezett szerkeszt≈ënek!"

# --- safe-lock.sh ---
echo "safe-lock.sh l√©trehoz√°sa..."
cat <<EOF > /usr/local/bin/safe-lock.sh
#!/usr/bin/env bash
# safe-lock.sh - xss-lock √°ltal h√≠vva

LOCK_CMD="i3lock-fancy"

is_video_playing() {
  players=\$(playerctl -l 2>/dev/null)
  [ -z "\$players" ] && return 1

  for p in \$players; do
    status=\$(playerctl -p "\$p" status 2>/dev/null || echo "")
    [ "\$status" != "Playing" ] && continue

    media_type=\$(playerctl -p "\$p" metadata mpris:media-type 2>/dev/null || echo "")

    if [ "\$media_type" = "Video" ]; then
      return 0
    fi

    case "\$p" in
      mpv|chromium*|brave*|chrome*|grayjay*)
        return 0
        ;;
    esac
  done

  return 1
}

if is_video_playing; then
  exit 0
fi

exec \$LOCK_CMD
EOF

chmod +x /usr/local/bin/safe-lock.sh
echo "Lock script elhelyezve."















# --- Cleanup: T√∂rl√©s /root-ban ---
echo "T√∂rl√©s /root-ban l√©v≈ë AwesomeWM telep√≠t√©si f√°jlok √©s mapp√°k..."

# T√∂rlend≈ë elemek list√°ja
root_items=(
  "/root/autostart/awesome-setup.desktop"
  "/root/awesome"
  "/root/darktable" 
  "/root/awesome-install"
  "/root/awesome-setup-wrapper.sh"
  "/root/awesome-setup.sh"
)

for item in "${root_items[@]}"; do
  if [ -e "$item" ]; then
    rm -rf "$item"
    echo "‚úÖ $item t√∂r√∂lve"
  else
    echo "‚ÑπÔ∏è  $item nem l√©tezik, kihagyva"
  fi
done

# --- Mappa tiszt√≠t√°s ---
echo "R√©gi AwesomeWM konfigur√°ci√≥s mapp√°k elt√°vol√≠t√°sa..."

# 1. Lek√©rj√ºk az eredeti felhaszn√°l√≥ home k√∂nyvt√°r√°t
USER_HOME=$(getent passwd "$SUDO_USER" | cut -d: -f6)

if [ -z "$USER_HOME" ]; then
    echo "Hiba: Nem tal√°lhat√≥ a(z) '$SUDO_USER' felhaszn√°l√≥ home k√∂nyvt√°ra."
    exit 1
fi

# T√∂rl√©s a felhaszn√°l√≥ home k√∂nyvt√°r√°b√≥l
if [ -d "$USER_HOME/.config/awesome/lain" ]; then
    rm -rf "$USER_HOME/.config/awesome/lain"
    echo "‚úÖ $USER_HOME/.config/awesome/lain mappa t√∂r√∂lve"
fi

if [ -d "$USER_HOME/.config/awesome/freedesktop" ]; then
    rm -rf "$USER_HOME/.config/awesome/freedesktop"
    echo "‚úÖ $USER_HOME/.config/awesome/freedesktop mappa t√∂r√∂lve"
fi

# T√∂rl√©s az /etc/skel-b≈ël
if [ -d "/etc/skel/.config/awesome/lain" ]; then
    rm -rf "/etc/skel/.config/awesome/lain"
    echo "‚úÖ /etc/skel/.config/awesome/lain mappa t√∂r√∂lve"
fi

if [ -d "/etc/skel/.config/awesome/freedesktop" ]; then
    rm -rf "/etc/skel/.config/awesome/freedesktop"
    echo "‚úÖ /etc/skel/.config/awesome/freedesktop mappa t√∂r√∂lve"
fi

# --- Szimbolikus linkek l√©trehoz√°sa ---
echo "Szimbolikus linkek l√©trehoz√°sa a freedesktop √©s lain mapp√°khoz..."

# Felhaszn√°l√≥ home k√∂nyvt√°r
sudo -u "$USERNAME" -H mkdir -p "$USER_HOME/.config/awesome"
if [ ! -L "$USER_HOME/.config/awesome/freedesktop" ]; then
    sudo -u "$USERNAME" -H ln -s /usr/share/lua/5.3/freedesktop "$USER_HOME/.config/awesome/freedesktop"
    echo "‚úÖ Link l√©trehozva: $USER_HOME/.config/awesome/freedesktop -> /usr/share/lua/5.3/freedesktop"
fi

if [ ! -L "$USER_HOME/.config/awesome/lain" ]; then
    sudo -u "$USERNAME" -H ln -s /usr/share/lua/5.3/lain "$USER_HOME/.config/awesome/lain"
    echo "‚úÖ Link l√©trehozva: $USER_HOME/.config/awesome/lain -> /usr/share/lua/5.3/lain"
fi

# /etc/skel
mkdir -p "/etc/skel/.config/awesome"
if [ ! -L "/etc/skel/.config/awesome/freedesktop" ]; then
    ln -s /usr/share/lua/5.3/freedesktop "/etc/skel/.config/awesome/freedesktop"
    echo "‚úÖ Link l√©trehozva: /etc/skel/.config/awesome/freedesktop -> /usr/share/lua/5.3/freedesktop"
fi

if [ ! -L "/etc/skel/.config/awesome/lain" ]; then
    ln -s /usr/share/lua/5.3/lain "/etc/skel/.config/awesome/lain"
    echo "‚úÖ Link l√©trehozva: /etc/skel/.config/awesome/lain -> /usr/share/lua/5.3/lain"
fi

# --- AwesomeWM Copycats ---
echo "AwesomeWM Copycats konfigur√°ci√≥ telep√≠t√©se $USERNAME sz√°m√°ra..."
cd /tmp
sudo -u "$USERNAME" -H git clone --branch Autoinstall --recurse-submodules --remote-submodules --depth 1 -j 2 \
  https://github.com/megvadulthangya/awesome-copycats-manjaro.git

if [ -d /tmp/awesome-copycats-manjaro ]; then

 # --- Nordic-cursors t√©ma telep√≠t√©se ---
  CURSOR_ARCHIVE="/tmp/awesome-copycats-manjaro/Nordic-cursors.tar.xz"
  if [ -f "$CURSOR_ARCHIVE" ]; then
    echo "Nordic-cursors t√©ma telep√≠t√©se..."
    tar -xJf "$CURSOR_ARCHIVE" -C /usr/share/icons/ && \
    rm "$CURSOR_ARCHIVE" && \
    echo "‚úÖ Nordic-cursors t√©ma sikeresen telep√≠tve √©s az arch√≠vum t√∂r√∂lve."
  else
    echo "FIGYELMEZTET√âS: A Nordic-cursors.tar.xz nem tal√°lhat√≥, a kurzor telep√≠t√©se kihagyva."
  fi
  
  # --- Fish konfigur√°ci√≥ telep√≠t√©se ---
  FISH_CONFIG_ARCHIVE="/tmp/awesome-copycats-manjaro/fish.cfg.tar.xz"
  if [ -f "$FISH_CONFIG_ARCHIVE" ]; then
    echo "Fish konfigur√°ci√≥ telep√≠t√©se..."
    FISH_CONFIG_DIR="$USER_HOME/.config/fish"
    sudo -u "$USERNAME" -H mkdir -p "$FISH_CONFIG_DIR" && \
    sudo -u "$USERNAME" -H tar -xJf "$FISH_CONFIG_ARCHIVE" -C "$FISH_CONFIG_DIR/" && \
    rm "$FISH_CONFIG_ARCHIVE" && \
    echo "‚úÖ Fish konfigur√°ci√≥ sikeresen telep√≠tve √©s az arch√≠vum t√∂r√∂lve."
  else
    echo "FIGYELMEZTET√âS: A fish.cfg.tar.xz nem tal√°lhat√≥, a fish konfigur√°ci√≥ telep√≠t√©se kihagyva."
  fi
  
  # Csak a sz√ºks√©ges elemek m√°sol√°sa
  sudo -u "$USERNAME" -H mkdir -p "$USER_HOME/.config/awesome"
  
  # Themes mappa m√°sol√°sa
  if [ -d "/tmp/awesome-copycats-manjaro/themes" ]; then
    sudo -u "$USERNAME" -H cp -r "/tmp/awesome-copycats-manjaro/themes" "$USER_HOME/.config/awesome/"
    echo "‚úÖ Themes mappa sikeresen m√°solva."
  fi
  
  # Tov√°bbi .xz f√°jlok kezel√©se (ha vannak)
  for xz_file in /tmp/awesome-copycats-manjaro/*.xz; do
    if [ -f "$xz_file" ] && [ "$(basename "$xz_file")" != "Nordic-cursors.tar.xz" ] && [ "$(basename "$xz_file")" != "fish.cfg.tar.xz" ]; then
      filename=$(basename "$xz_file")
      echo "Tov√°bbi .xz f√°jl tal√°lhat√≥: $filename"
      # Itt adhatunk hozz√° tov√°bbi kezel√©si logik√°t, ha sz√ºks√©ges
    fi
  done
  
  rm -rf /tmp/awesome-copycats-manjaro
  echo "‚úÖ Csak a sz√ºks√©ges elemek m√°solva ide: $USER_HOME/.config/awesome"
else
  echo "HIBA: Nem siker√ºlt kl√≥nozni a rep√≥t!"
fi

echo "‚úÖ A cleanup √©s √∫j konfigur√°ci√≥ telep√≠t√©se befejez≈ëd√∂tt."

















echo "=== i3lock-fancy jav√≠t√°sa (convert ‚Üí magick convert) ==="
if [ -f /usr/bin/i3lock-fancy ]; then
  sed -i 's/\bconvert\b/magick/g' /usr/bin/i3lock-fancy
  echo "i3lock-fancy sikeresen jav√≠tva!"
else
  echo "Figyelem: /usr/bin/i3lock-fancy nem tal√°lhat√≥."
fi

# ----------------------------------------------------------------------
# XFCE NORDIC T√âMA BE√ÅLL√çT√ì SCRIPTE (SUDO-KOMPATIBILIS)
# ----------------------------------------------------------------------

# 1. C√©lfelhaszn√°l√≥ azonos√≠t√°sa
if [ "$EUID" -ne 0 ]; then
  echo "Hiba: A szkriptet root jogosults√°gokkal (sudo-val) kell futtatni."
  exit 1
fi

TARGET_USER=${SUDO_USER}

if [ -z "$TARGET_USER" ]; then
  TARGET_USER=$(logname 2>/dev/null)
fi

if [ -z "$TARGET_USER" ]; then
  echo "Hiba: Nem siker√ºlt azonos√≠tani a c√©lfelhaszn√°l√≥t (SUDO_USER √ºres vagy logname sikertelen)."
  echo "A szkript futtat√°sa megszak√≠tva."
  exit 1
fi

TARGET_UID=$(id -u ${TARGET_USER})
RUNNER="sudo -u ${TARGET_USER} DBUS_SESSION_BUS_ADDRESS=unix:path=/run/user/${TARGET_UID}/bus"

echo "Be√°ll√≠t√°sok futtat√°sa a k√∂vetkez≈ë felhaszn√°l√≥ nev√©ben: ${TARGET_USER} (UID: ${TARGET_UID})"
echo "---"

# 3. Xfconf be√°ll√≠t√°sok elind√≠t√°sa
echo "-> GTK T√©ma be√°ll√≠t√°sa: Nordic"
${RUNNER} xfconf-query -c xsettings -p /Net/ThemeName -s "Nordic-standard-buttons" --create -t string

echo "-> Ikon T√©ma be√°ll√≠t√°sa: Nordzy-dark"
${RUNNER} xfconf-query -c xsettings -p /Net/IconThemeName -s "Nordzy-dark" --create -t string

echo "-> Eg√©rmutat√≥ T√©ma be√°ll√≠t√°sa: Nordic-cursors"
${RUNNER} xfconf-query -c xsettings -p /Gtk/CursorThemeName -s "Nordic-cursors" --create -t string

echo "-> Sz√≠npaletta be√°ll√≠t√°sa..."
COLOR_PALETTE="black:white:gray50:red:purple:blue:light blue:green:yellow:orange:lavender:brown:goldenrod4:dodger blue:pink:light green:gray10:gray30:gray75:gray90"
${RUNNER} xfconf-query -c xsettings -p /Gtk/ColorPalette -s "${COLOR_PALETTE}" --create -t string

echo "---"
echo "‚úÖ Az Xfce Nordic t√©ma be√°ll√≠t√°sai sikeresen alkalmazva a ${TARGET_USER} felhaszn√°l√≥nak."

# ----------------------------------------------------------------------
# GTK √âS QT BE√ÅLL√çT√ÅSOK
# ----------------------------------------------------------------------

# Ellen≈ërizz√ºk, hogy a scriptet root-k√©nt (sudo-val) futtatj√°k-e
if [ "$EUID" -ne 0 ]; then
  echo "K√©rlek futtasd ezt a scriptet sudo-val: sudo $0"
  exit 1
fi

# A felhaszn√°l√≥, aki a sudo-t haszn√°lta
REGULAR_USER=${SUDO_USER:-root}
REGULAR_USER_HOME=$(eval echo ~$REGULAR_USER)

# --- GTK BE√ÅLL√çT√ÅSOK ---
apply_gtk_settings() {
  local TARGET_HOME=$1
  local TARGET_USER=$2

  echo "=> GTK be√°ll√≠t√°sok alkalmaz√°sa a(z) '$TARGET_USER' felhaszn√°l√≥ sz√°m√°ra a '$TARGET_HOME' mapp√°ban..."

  # GTK-2.0 be√°ll√≠t√°sok
  cat <<EOF > "$TARGET_HOME/.gtkrc-2.0"
# DO NOT EDIT! This file will be overwritten by LXAppearance.
# Any customization should be done in ~/.gtkrc-2.0.mine instead.

include "~/.gtkrc-2.0.mine"
gtk-theme-name="Nordic-standard-buttons"
gtk-icon-theme-name="Nordzy-dark"
gtk-font-name="FiraCode Nerd Font 12"
gtk-cursor-theme-name="Nordic-cursors"
gtk-cursor-theme-size=16
gtk-toolbar-style=GTK_TOOLBAR_ICONS
gtk-toolbar-icon-size=GTK_ICON_SIZE_LARGE_TOOLBAR
gtk-button-images=1
gtk-menu-images=1
gtk-sound-theme-name=freedesktop
gtk-enable-event-sounds=1
gtk-enable-input-feedback-sounds=1
gtk-xft-antialias=1
gtk-xft-hinting=1
gtk-xft-hintstyle="hintfull"
gtk-xft-rgba="rgb"
gtk-application-prefer-dark-theme=1
EOF

  # GTK-3.0 be√°ll√≠t√°sok
  mkdir -p "$TARGET_HOME/.config/gtk-3.0"
  cat <<EOF > "$TARGET_HOME/.config/gtk-3.0/settings.ini"
[Settings]
gtk-theme-name=Nordic-standard-buttons
gtk-icon-theme-name=Nordzy-dark
gtk-font-name=FiraCode Nerd Font 12
gtk-cursor-theme-name=Nordic-cursors
gtk-toolbar-style=GTK_TOOLBAR_ICONS
gtk-toolbar-icon-size=GTK_ICON_SIZE_LARGE_TOOLBAR
gtk-button-images=1
gtk-menu-images=1
gtk-enable-event-sounds=1
gtk-enable-input-feedback-sounds=1
gtk-xft-antialias=1
gtk-xft-hinting=1
gtk-xft-hintstyle=hinfull
gtk-sound-theme-name=freedesktop
gtk-application-prefer-dark-theme=1
EOF

  # Tulajdonos be√°ll√≠t√°sa
  chown -R "$TARGET_USER:$TARGET_USER" "$TARGET_HOME/.gtkrc-2.0" "$TARGET_HOME/.config"
  echo "GTK2/GTK3 k√©sz!"
  echo
}

# --- QT BE√ÅLL√çT√ÅSOK ---
apply_qt_settings() {
  local TARGET_HOME=$1
  local TARGET_USER=$2

  echo "=> Qt5/Qt6 be√°ll√≠t√°sok alkalmaz√°sa a(z) '$TARGET_USER' felhaszn√°l√≥ sz√°m√°ra a '$TARGET_HOME' mapp√°ban..."

  # --- Qt5ct ---
  mkdir -p "$TARGET_HOME/.config/qt5ct"
  cat <<EOF > "$TARGET_HOME/.config/qt5ct/qt5ct.conf"
[Appearance]
color_scheme_path=/usr/share/qt5ct/colors/darker.conf
custom_palette=true
icon_theme=Nordzy-dark
standard_dialogs=default
style=Fusion

[Fonts]
fixed="FiraCode Nerd Font,12,-1,5,50,0,0,0,0,0,Regular"
general="FiraCode Nerd Font,12,-1,5,50,0,0,0,0,0,Regular"

[Interface]
activate_item_on_single_click=1
buttonbox_layout=3
cursor_flash_time=1000
dialog_buttons_have_icons=1
double_click_interval=400
gui_effects=@Invalid()
keyboard_scheme=2
menus_have_icons=true
show_shortcuts_in_context_menus=true
stylesheets=@Invalid()
toolbutton_style=4
underline_shortcut=1
wheel_scroll_lines=3

[SettingsWindow]
geometry=@ByteArray(\x1\xd9\xd0\xcb\0\x3\0\0\0\0\0\0\0\0\0\0\0\0\x4\xff\0\0\x2\xfa\0\0\0\0\0\0\0\x1c\0\0\x4\xff\0\0\x2\xfa\0\0\0\0\x2\0\0\0\x5\0\0\0\0\0\0\0\0 \0\0\x4\xff\0\0\x2\xfa)

[Troubleshooting]
force_raster_widgets=1
ignored_applications=@Invalid()
EOF

  # --- Qt6ct ---
  mkdir -p "$TARGET_HOME/.config/qt6ct"
  cat <<EOF > "$TARGET_HOME/.config/qt6ct/qt6ct.conf"
[Appearance]
custom_palette=false
icon_theme=Nordzy-dark
standard_dialogs=default
style=kvantum

[Fonts]
fixed="FiraCode Nerd Font,12,-1,5,400,0,0,0,0,0,0,0,0,0,0,1,Regular"
general="FiraCode Nerd Font,12,-1,5,400,0,0,0,0,0,0,0,0,0,0,1,Regular"

[Interface]
activate_item_on_single_click=1
buttonbox_layout=0
cursor_flash_time=1200
dialog_buttons_have_icons=1
double_click_interval=532
gui_effects=@Invalid()
keyboard_scheme=2
menus_have_icons=true
show_shortcuts_in_context_menus=true
stylesheets=@Invalid()
toolbutton_style=4
underline_shortcut=1
wheel_scroll_lines=3

[SettingsWindow]
geometry=@ByteArray(\x1\xd9\xd0\xcb\0\x3\0\0\0\0\0\0\0\0\0\0\0\0\x4\xff\0\0\x2\xfa\0\0\0\0\0\0\0 \0\0\x4\xff\0\0\x2\xfa\0\0\0\0\x2\0\0\0\x5\0\0\0\0\0\0\0\0 \0\0\x4\xff\0\0\x2\xfa)

[Troubleshooting]
force_raster_widgets=1
ignored_applications=@Invalid()
EOF

  # Tulajdonos be√°ll√≠t√°sa
  chown -R "$TARGET_USER:$TARGET_USER" "$TARGET_HOME/.config/qt5ct" "$TARGET_HOME/.config/qt6ct"
  echo "Qt5/Qt6 k√©sz!"
  echo
}

# --- A SCRIPT F≈ê R√âSZE: A FUNKCI√ì MEGH√çV√ÅSA ---

# 1. Alkalmazzuk a be√°ll√≠t√°sokat a SUDO-t futtat√≥ felhaszn√°l√≥ra
if [ "$REGULAR_USER" != "root" ]; then
    apply_gtk_settings "$REGULAR_USER_HOME" "$REGULAR_USER"
    apply_qt_settings "$REGULAR_USER_HOME" "$REGULAR_USER"
else
    echo "=> A scriptet k√∂zvetlen√ºl root-k√©nt futtatod, a felhaszn√°l√≥i be√°ll√≠t√°sokat √°tugorjuk."
    echo
fi

# 2. Alkalmazzuk a be√°ll√≠t√°sokat a ROOT felhaszn√°l√≥ra
apply_gtk_settings ~ "root"
apply_qt_settings ~ "root"

echo "Minden GTK √©s Qt be√°ll√≠t√°s sikeresen alkalmazva."

# ----------------------------------------------------------------------
# KVANTUM T√âM√ÅK TELEP√çT√âSE RENDSZERSZINTEN
# ----------------------------------------------------------------------

echo "=== Kvantum t√©m√°k telep√≠t√©se rendszerszinten ==="

# Kvantum t√©m√°k let√∂lt√©se √©s RENDSZERSZINT≈∞ telep√≠t√©se
echo "Nordic Kvantum t√©m√°k let√∂lt√©se rendszerszintre..."
cd /tmp
if [ -d "Nordic" ]; then
    rm -rf Nordic
fi

git clone --depth=1 https://github.com/EliverLara/Nordic.git
cd Nordic/kde/kvantum

# RENDSZERSZINT≈∞ t√©m√°k telep√≠t√©se - /usr/share/Kvantum mapp√°ba
KVANTUM_SYSTEM_DIR="/usr/share/Kvantum"
mkdir -p "$KVANTUM_SYSTEM_DIR"

# T√©m√°k kicsomagol√°sa RENDSZERSZINT≈∞ k√∂nyvt√°rba
for theme_file in *.tar.xz; do
    if [ -f "$theme_file" ]; then
        theme_name="${theme_file%.tar.xz}"
        echo "Kvantum t√©ma telep√≠t√©se rendszerszintre: $theme_name"
        tar -xf "$theme_file" -C "$KVANTUM_SYSTEM_DIR/"
        # Jogok be√°ll√≠t√°sa, hogy mindenki el√©rhesse
        chmod -R 755 "$KVANTUM_SYSTEM_DIR/$theme_name"
    fi
done

# Ha nincsenek tar.xz f√°jlok, akkor a mapp√°kat m√°soljuk
if [ ! -f "Nordic.tar.xz" ]; then
    for theme_dir in Nordic*; do
        if [ -d "$theme_dir" ]; then
            echo "Kvantum t√©ma m√°sol√°sa rendszerszintre: $theme_dir"
            cp -r "$theme_dir" "$KVANTUM_SYSTEM_DIR/"
            chmod -R 755 "$KVANTUM_SYSTEM_DIR/$theme_dir"
        fi
    done
fi

echo "‚úÖ Kvantum t√©m√°k telep√≠tve rendszerszinten"

# Takar√≠t√°s
cd /
rm -rf /tmp/Nordic

# ----------------------------------------------------------------------
# LIGHTDM GREETER BE√ÅLL√çT√ÅSA
# ----------------------------------------------------------------------

echo "=== LightDM GTK Greeter be√°ll√≠t√°sa ==="

# Ellen≈ërizz√ºk, hogy a k√©p f√°jl l√©tezik-e
BACKGROUND_FILE="/usr/share/backgrounds/nordic-wallpapers-git/ign_groot.png"
if [ ! -f "$BACKGROUND_FILE" ]; then
    echo "Figyelem: A h√°tt√©rk√©p nem tal√°lhat√≥: $BACKGROUND_FILE"
    echo "Alternat√≠v h√°tt√©rk√©p keres√©se..."
    # Alternat√≠v h√°tt√©rk√©p keres√©se
    ALTERNATIVE_BG=$(find /usr/share/backgrounds/nordic-wallpapers-git -name "*.png" -o -name "*.jpg" | head -1)
    if [ -n "$ALTERNATIVE_BG" ]; then
        BACKGROUND_FILE="$ALTERNATIVE_BG"
        echo "Alternat√≠v h√°tt√©rk√©p haszn√°lata: $BACKGROUND_FILE"
    else
        echo "Hiba: Nem tal√°lhat√≥ h√°tt√©rk√©p a nordic-wallpapers-git mapp√°ban!"
    fi
fi

# LightDM config f√°jl biztons√°gi ment√©se
LIGHTDM_CONFIG="/etc/lightdm/lightdm-gtk-greeter.conf"
if [ -f "$LIGHTDM_CONFIG" ]; then
    cp "$LIGHTDM_CONFIG" "${LIGHTDM_CONFIG}.backup.$(date +%Y%m%d%H%M%S)"
    echo "LightDM config biztons√°gi ment√©se k√©sz"
fi

# LightDM greeter konfigur√°ci√≥ alkalmaz√°sa
echo "LightDM greeter konfigur√°ci√≥ be√°ll√≠t√°sa..."
cat > "$LIGHTDM_CONFIG" << EOF
[greeter]
background = $BACKGROUND_FILE
user-background = false
font-name = FiraCode Nerd Font 12
xft-antialias = true
icon-theme-name = Nordzy
screensaver-timeout = 60
theme-name = Nordic
cursor-theme-name = Nordic-cursors
show-clock = true
default-user-image = #manjaro
xft-hintstyle = hintfull
position = 20%,center 40%,center
clock-format = %Y.%m.%d %H:%M
panel-position = bottom
indicators = ~host;~spacer;~clock;~spacer;~language;~session;~a11y;~power
EOF

echo "‚úÖ LightDM GTK Greeter be√°ll√≠tva"

# ----------------------------------------------------------------------
# FISH SHELL ALAP√âRTELMEZETT√â T√âTELE
# ----------------------------------------------------------------------

echo "=== Fish shell alap√©rtelmezett√© t√©tele ==="

# A Fish shell teljes el√©r√©si √∫tj√°nak megkeres√©se
FISH_PATH=$(command -v fish)

# Ellen≈ërz√©s, hogy a Fish telep√≠tve van-e
if [ -z "$FISH_PATH" ]; then
    echo "Hiba: A Fish shell nincs telep√≠tve vagy nem tal√°lhat√≥ az el√©r√©si √∫tvonalon."
    exit 1
fi

echo "Fish shell alap√©rtelmezett√© t√©tele..."

# Hozz√°adjuk a Fish-t az enged√©lyezett shellekhez, ha m√©g nem szerepel ott
if ! grep -q "^${FISH_PATH}$" /etc/shells; then
    echo "A(z) '$FISH_PATH' hozz√°ad√°sa a /etc/shells f√°jlhoz..."
    echo "$FISH_PATH" | tee -a /etc/shells
fi

# Alap√©rtelmezett shell be√°ll√≠t√°sa a root felhaszn√°l√≥nak
echo "Shell be√°ll√≠t√°sa a 'root' felhaszn√°l√≥nak..."
chsh -s "$FISH_PATH" root

echo "K√©sz! A Fish shell sikeresen be√°ll√≠tva."

# ===========================================================================
# === KONFIGUR√ÅCI√ìS F√ÅJLOK BE√ÅLL√çT√ÅSA - JELENLEGI FELHASZN√ÅL√ì √âS /etc/skel ===
# ===========================================================================

echo "=== Konfigur√°ci√≥s f√°jlok be√°ll√≠t√°sa mindenkinek ==="

# --- F√ºggv√©ny f√°jlok m√°sol√°s√°ra felhaszn√°l√≥hoz √©s /etc/skel-be ---
setup_config_file() {
    local source_content="$1"
    local user_path="$2"
    local skel_path="/etc/skel/${user_path#$USER_HOME/}"
    local user_dir=$(dirname "$user_path")
    local skel_dir=$(dirname "$skel_path")
    
    # Felhaszn√°l√≥i f√°jl l√©trehoz√°sa
    echo "  Felhaszn√°l√≥: $user_path"
    sudo -u "$USERNAME" mkdir -p "$user_dir"
    echo "$source_content" | sudo -u "$USERNAME" tee "$user_path" > /dev/null
    
    # /etc/skel f√°jl l√©trehoz√°sa
    echo "  /etc/skel: $skel_path"
    mkdir -p "$skel_dir"
    echo "$source_content" | tee "$skel_path" > /dev/null
}

# --- Geany color scheme ---
#echo "Geany color scheme be√°ll√≠t√°sa..."
#setup_config_file '[geany]
#color_scheme=nord.conf' "$USER_HOME/.config/geany/geany.conf"

# --- Zsh be√°ll√≠t√°sok ---
echo "Zsh be√°ll√≠t√°sa..."
setup_config_file '# Use powerline
USE_POWERLINE="true"
# Has weird character width
# Example:
#   ÓÇ≤ÓÇ∞ is not a diamond
HAS_WIDECHARS="false"
# Source manjaro-zsh-configuration
if [[ -e /usr/share/zsh/manjaro-zsh-config ]]; then
  source /usr/share/zsh/manjaro-zsh-config
fi
# Use manjaro zsh prompt
if [[ -e /usr/share/zsh/manjaro-zsh-prompt ]]; then
  source /usr/share/zsh/manjaro-zsh-prompt
fi
if [ $TILIX_ID ] || [ $VTE_VERSION ]; then
        source /etc/profile.d/vte.sh
fi' "$USER_HOME/.zshrc"

# --- Kvantum be√°ll√≠t√°s --- FIXED VERSION ---
echo "Kvantum be√°ll√≠t√°sa..."
KVANTUM_CONFIG='[General]
theme=Nordic'

# Felhaszn√°l√≥i konfigur√°ci√≥
KVANTUM_USER_DIR="$USER_HOME/.config/Kvantum"
KVANTUM_USER_FILE="$KVANTUM_USER_DIR/kvantum.kvconfig"
sudo -u "$USERNAME" mkdir -p "$KVANTUM_USER_DIR"
echo "$KVANTUM_CONFIG" | sudo -u "$USERNAME" tee "$KVANTUM_USER_FILE" > /dev/null

# /etc/skel konfigur√°ci√≥
KVANTUM_SKEL_DIR="/etc/skel/.config/Kvantum"
KVANTUM_SKEL_FILE="$KVANTUM_SKEL_DIR/kvantum.kvconfig"
mkdir -p "$KVANTUM_SKEL_DIR"
echo "$KVANTUM_CONFIG" | tee "$KVANTUM_SKEL_FILE" > /dev/null

echo "‚úÖ Kvantum konfigur√°ci√≥ be√°ll√≠tva"

# --- .xprofile be√°ll√≠t√°s ---
echo ".xprofile be√°ll√≠t√°sa..."
setup_config_file 'export QT_QPA_PLATFORMTHEME="qt6ct"
# Monitor setup
if [ -f "$HOME/.screenlayout/layout.sh" ]; then
    # Mivel ez az X session ind√≠t√°sakor fut, a DISPLAY m√°r el√©rhet≈ë
    bash "$HOME/.screenlayout/layout.sh" &
fi
' "$USER_HOME/.xprofile"

# --- .profile be√°ll√≠t√°s ---
echo ".profile be√°ll√≠t√°sa..."
setup_config_file 'export EDITOR=/usr/bin/nano
export QT_QPA_PLATFORMTHEME="qt6ct"
export QT_AUTO_SCREEN_SCALE_FACTOR=0
export GTK2_RC_FILES="$HOME/.gtkrc-2.0"' "$USER_HOME/.profile"

# === Bashrc be√°ll√≠t√°sok (biztons√°gos, hozz√°f≈±z≈ë m√≥dszer) ===
echo "Bashrc be√°ll√≠t√°sa (hozz√°f≈±z√©ssel)..."

# Defini√°ljuk a k√≥dr√©szletet, amit hozz√° akarunk adni
VTE_SNIPPET=$(cat <<'EOF'

# Automatikusan hozz√°adva a Tilix/VTE integr√°ci√≥hoz
if [ $TILIX_ID ] || [ $VTE_VERSION ]; then
    source /etc/profile.d/vte.sh
fi
EOF
)

# --- 1. Felhaszn√°l√≥i .bashrc m√≥dos√≠t√°sa ---
BASHRC_USER_PATH="$USER_HOME/.bashrc"
echo "  Ellen≈ërz√©s: $BASHRC_USER_PATH"

# Ellen≈ërizz√ºk, hogy a bejegyz√©s m√°r l√©tezik-e, hogy elker√ºlj√ºk a duplik√°ci√≥t
if ! grep -q "source /etc/profile.d/vte.sh" "$BASHRC_USER_PATH" 2>/dev/null; then
    echo "  VTE bejegyz√©s hozz√°ad√°sa a felhaszn√°l√≥ .bashrc f√°jlj√°hoz..."
    # Hozz√°f≈±zz√ºk a k√≥dr√©szletet a f√°jl v√©g√©hez
    echo "$VTE_SNIPPET" | sudo -u "$USERNAME" tee -a "$BASHRC_USER_PATH" > /dev/null
else
    echo "  A VTE bejegyz√©s m√°r l√©tezik, nincs teend≈ë."
fi

# --- 2. /etc/skel/.bashrc m√≥dos√≠t√°sa ---
BASHRC_SKEL_PATH="/etc/skel/.bashrc"
echo "  Ellen≈ërz√©s: $BASHRC_SKEL_PATH"

# Itt is ellen≈ërizz√ºk a duplik√°ci√≥t
if ! grep -q "source /etc/profile.d/vte.sh" "$BASHRC_SKEL_PATH" 2>/dev/null; then
    echo "  VTE bejegyz√©s hozz√°ad√°sa a /etc/skel/.bashrc f√°jlhoz..."
    # Hozz√°f≈±zz√ºk a k√≥dr√©szletet a f√°jl v√©g√©hez (itt m√°r nem kell sudo -u)
    echo "$VTE_SNIPPET" | tee -a "$BASHRC_SKEL_PATH" > /dev/null
else
    echo "  A VTE bejegyz√©s m√°r l√©tezik, nincs teend≈ë."
fi

echo "Bashrc be√°ll√≠t√°sa k√©sz."

# --- XFCE xsettings be√°ll√≠t√°sok ---
echo "XFCE xsettings be√°ll√≠t√°sa..."
setup_config_file '<?xml version="1.1" encoding="UTF-8"?>

<channel name="xsettings" version="1.0">
  <property name="Net" type="empty">
    <property name="ThemeName" type="string" value="Nordic-standard-buttons"/>
    <property name="IconThemeName" type="string" value="Nordzy-dark"/>
    <property name="DoubleClickTime" type="int" value="532"/>
    <property name="DoubleClickDistance" type="int" value="8"/>
    <property name="DndDragThreshold" type="int" value="8"/>
    <property name="CursorBlink" type="bool" value="true"/>
    <property name="CursorBlinkTime" type="int" value="1200"/>
    <property name="SoundThemeName" type="string" value="default"/>
    <property name="EnableEventSounds" type="bool" value="false"/>
    <property name="EnableInputFeedbackSounds" type="bool" value="false"/>
  </property>
  <property name="Xft" type="empty">
    <property name="DPI" type="int" value="96"/>
    <property name="Antialias" type="int" value="1"/>
    <property name="Hinting" type="int" value="-1"/>
    <property name="HintStyle" type="string" value="hintfull"/>
    <property name="RGBA" type="string" value="none"/>
  </property>
  <property name="Gtk" type="empty">
    <property name="CanChangeAccels" type="bool" value="false"/>
    <property name="ColorPalette" type="string" value="black:white:gray50:red:purple:blue:light blue:green:yellow:orange:lavender:brown:goldenrod4:dodger blue:pink:light green:gray10:gray30:gray75:gray90"/>
    <property name="FontName" type="string" value="FiraCode Nerd Font 12"/>
    <property name="MonospaceFontName" type="empty"/>
    <property name="IconSizes" type="string" value=""/>
    <property name="KeyThemeName" type="string" value=""/>
    <property name="MenuImages" type="bool" value="true"/>
    <property name="ButtonImages" type="bool" value="true"/>
    <property name="MenuBarAccel" type="string" value="F10"/>
    <property name="CursorThemeName" type="string" value="Nordic-cursors"/>
    <property name="CursorThemeSize" type="int" value="0"/>
    <property name="DecorationLayout" type="string" value="icon,menu:minimize,maximize,close"/>
    <property name="DialogsUseHeader" type="empty"/>
    <property name="TitlebarMiddleClick" type="empty"/>
    <property name="ToolbarStyle" type="string" value="icons"/>
    <property name="ToolbarIconSize" type="int" value="3"/>
    <property name="IMPreeditStyle" type="string" value=""/>
    <property name="IMStatusStyle" type="string" value=""/>
    <property name="IMModule" type="string" value=""/>
  </property>
  <property name="Gdk" type="empty">
    <property name="WindowScalingFactor" type="empty"/>
  </property>
  <property name="Xfce" type="empty">
    <property name="LastCustomDPI" type="int" value="96"/>
  </property>
</channel>' "$USER_HOME/.config/xfce4/xfconf/xfce-perchannel-xml/xsettings.xml"

# --- XFCE xfwm4 be√°ll√≠t√°sok ---
echo "XFCE xfwm4 be√°ll√≠t√°sa..."
setup_config_file '<?xml version="1.0" encoding="UTF-8"?>

<channel name="xfwm4" version="1.0">
  <property name="general" type="empty">
    <property name="activate_action" type="string" value="bring"/>
    <property name="borderless_maximize" type="bool" value="true"/>
    <property name="box_move" type="bool" value="false"/>
    <property name="box_resize" type="bool" value="false"/>
    <property name="button_layout" type="string" value="O|SHMC"/>
    <property name="button_offset" type="int" value="0"/>
    <property name="button_spacing" type="int" value="0"/>
    <property name="click_to_focus" type="bool" value="true"/>
    <property name="focus_delay" type="int" value="250"/>
    <property name="cycle_apps_only" type="bool" value="false"/>
    <property name="cycle_draw_frame" type="bool" value="true"/>
    <property name="cycle_hidden" type="bool" value="true"/>
    <property name="cycle_minimum" type="bool" value="true"/>
    <property name="cycle_workspaces" type="bool" value="false"/>
    <property name="double_click_time" type="int" value="250"/>
    <property name="double_click_distance" type="int" value="5"/>
    <property name="double_click_action" type="string" value="maximize"/>
    <property name="easy_click" type="string" value="Alt"/>
    <property name="focus_hint" type="bool" value="true"/>
    <property name="focus_new" type="bool" value="true"/>
    <property name="frame_opacity" type="int" value="100"/>
    <property name="full_width_title" type="bool" value="true"/>
    <property name="inactive_opacity" type="int" value="100"/>
    <property name="maximized_offset" type="int" value="0"/>
    <property name="move_opacity" type="int" value="100"/>
    <property name="placement_ratio" type="int" value="60"/>
    <property name="placement_mode" type="string" value="center"/>
    <property name="popup_opacity" type="int" value="100"/>
    <property name="mousewheel_rollup" type="bool" value="true"/>
    <property name="prevent_focus_stealing" type="bool" value="false"/>
    <property name="raise_delay" type="int" value="250"/>
    <property name="raise_on_click" type="bool" value="true"/>
    <property name="raise_on_focus" type="bool" value="false"/>
    <property name="raise_with_any_button" type="bool" value="true"/>
    <property name="repeat_urgent_blink" type="bool" value="false"/>
    <property name="resize_opacity" type="int" value="100"/>
    <property name="restore_on_move" type="bool" value="true"/>
    <property name="scroll_workspaces" type="bool" value="true"/>
    <property name="shadow_delta_height" type="int" value="0"/>
    <property name="shadow_delta_width" type="int" value="0"/>
    <property name="shadow_delta_x" type="int" value="0"/>
    <property name="shadow_delta_y" type="int" value="-3"/>
    <property name="shadow_opacity" type="int" value="50"/>
    <property name="show_app_icon" type="bool" value="false"/>
    <property name="show_dock_shadow" type="bool" value="true"/>
    <property name="show_frame_shadow" type="bool" value="true"/>
    <property name="show_popup_shadow" type="bool" value="false"/>
    <property name="snap_resist" type="bool" value="false"/>
    <property name="snap_to_border" type="bool" value="true"/>
    <property name="snap_to_windows" type="bool" value="false"/>
    <property name="snap_width" type="int" value="10"/>
    <property name="theme" type="string" value="Nordic-standard-buttons"/>
    <property name="title_alignment" type="string" value="center"/>
    <property name="title_font" type="string" value="FiraCode Nerd Font 12"/>
    <property name="title_horizontal_offset" type="int" value="0"/>
    <property name="title_shadow_active" type="string" value="false"/>
    <property name="title_shadow_inactive" type="string" value="false"/>
    <property name="title_vertical_offset_active" type="int" value="0"/>
    <property name="title_vertical_offset_inactive" type="int" value="0"/>
    <property name="toggle_workspaces" type="bool" value="false"/>
    <property name="unredirect_overlays" type="bool" value="true"/>
    <property name="urgent_blink" type="bool" value="false"/>
    <property name="use_compositing" type="bool" value="true"/>
    <property name="workspace_count" type="int" value="2"/>
    <property name="wrap_cycle" type="bool" value="true"/>
    <property name="wrap_layout" type="bool" value="true"/>
    <property name="wrap_resistance" type="int" value="10"/>
    <property name="wrap_windows" type="bool" value="true"/>
    <property name="wrap_workspaces" type="bool" value="false"/>
    <property name="workspace_names" type="array">
      <value type="string" value="Workspace 1"/>
      <value type="string" value="Workspace 2"/>
      <value type="string" value="Workspace 3"/>
      <value type="string" value="Workspace 4"/>
    </property>
    <property name="tile_on_move" type="bool" value="true"/>
    <property name="titleless_maximize" type="bool" value="false"/>
    <property name="cycle_preview" type="bool" value="true"/>
    <property name="cycle_tabwin_mode" type="int" value="0"/>
    <property name="sync_to_vblank" type="bool" value="true"/>
    <property name="zoom_desktop" type="bool" value="true"/>
  </property>
</channel>' "$USER_HOME/.config/xfce4/xfconf/xfce-perchannel-xml/xfwm4.xml"

# --- Flameshot be√°ll√≠t√°sok ---
echo "Flameshot be√°ll√≠t√°sa..."
setup_config_file '[General]
contrastOpacity=188
drawColor=#ff0000
uiColor=#f5eef8' "$USER_HOME/.config/flameshot/flameshot.ini"

# --- Fontok √°thelyez√©se rendszerszint≈±v√© ---
echo "Fontok √°thelyez√©se rendszerszint≈±v√©..."
mkdir -p /usr/share/fonts/truetype/custom

# Felhaszn√°l√≥ fontjainak √°thelyez√©se
if [ -d "$USER_HOME/.local/share/fonts" ]; then
    echo "Felhaszn√°l√≥ fontjainak √°thelyez√©se rendszerszint≈±v√©..."
    mv "$USER_HOME/.local/share/fonts"/* /usr/share/fonts/truetype/custom/ 2>/dev/null || true
    rmdir "$USER_HOME/.local/share/fonts" 2>/dev/null || true
fi

# /etc/skel font mappa √ºr√≠t√©se, mert a fontok most m√°r rendszerszint≈±ek
if [ -d "/etc/skel/.local/share/fonts" ]; then
    echo "/etc/skel font mappa √ºr√≠t√©se..."
    rm -rf /etc/skel/.local/share/fonts
fi

fc-cache -fv
echo "‚úÖ Fontok √°thelyezve rendszerszint≈±v√©: /usr/share/fonts/truetype/custom/"

# --- AwesomeWM √©s Rofi m√°sol√°sa /etc/skel-be ---
echo "AwesomeWM √©s Rofi konfigur√°ci√≥ m√°sol√°sa /etc/skel-be..."
if [ -d "$USER_HOME/.config/awesome" ]; then
    mkdir -p /etc/skel/.config
    cp -r "$USER_HOME/.config/awesome" /etc/skel/.config/
    # Sablonos√≠tjuk a rc.lua-t
    if [ -f "/etc/skel/.config/awesome/rc.lua" ]; then
        sed -i "s|${USER_HOME}|__USER_HOME__|g" "/etc/skel/.config/awesome/rc.lua"
    fi
fi

if [ -d "$USER_HOME/.config/rofi" ]; then
    mkdir -p /etc/skel/.config
    cp -r "$USER_HOME/.config/rofi" /etc/skel/.config/
fi

if [ -d "$USER_HOME/.config/fish" ]; then
    mkdir -p /etc/skel/.config
    cp -r "$USER_HOME/.config/fish" /etc/skel/.config/
fi


echo "==> Enged√©lyezem a udisks2 szolg√°ltat√°st..."
systemctl enable udisks2.service

echo "==> Ind√≠tom a udisks2 szolg√°ltat√°st..."
systemctl start udisks2.service

echo "==> Ellen≈ërz√©s..."
STATUS=$(systemctl is-enabled udisks2.service)
if [ "$STATUS" = "enabled" ]; then
    echo "‚úÖ udisks2 automatikus ind√≠t√°sa enged√©lyezve"
else
    echo "‚ö†Ô∏è  Nem siker√ºlt enged√©lyezni a szolg√°ltat√°st!"
fi

systemctl status udisks2.service --no-pager


# --- MPD felhaszn√°l√≥i szolg√°ltat√°s ind√≠t√°sa ---
echo "MPD felhaszn√°l√≥i szolg√°ltat√°s ind√≠t√°sa..."
if [ -n "$SUDO_USER" ]; then
    USER_HOME=$(getent passwd "$SUDO_USER" | cut -d: -f6)
    sudo -u "$SUDO_USER" DBUS_SESSION_BUS_ADDRESS=unix:path=/run/user/$(id -u "$SUDO_USER")/bus systemctl --user enable --now mpd
    echo "‚úÖ MPD felhaszn√°l√≥i szolg√°ltat√°s ind√≠tva"
else
    echo "‚ö†Ô∏è  MPD szolg√°ltat√°s ind√≠t√°sa kihagyva (nincs SUDO_USER)"
fi


echo "=== üí£ Mission Impossibru - Dual-Stage Edition w/ Logging ==="

USERNAME=$(logname)
USER_HOME=$(eval echo "~$USERNAME")
SOURCE_DIR="$USER_HOME/.config/rofi/scripts"
TARGET_DIR="$USER_HOME/.local/bin"
SKEL_DIR="/etc/skel"
MAIN_SCRIPT_NAME="mission_impossibru.sh"
USER_SCRIPT_NAME="mission_user_firstlogin.sh"

echo "üë§ Aktu√°lis felhaszn√°l√≥: $USERNAME"
echo "üè† Home: $USER_HOME"

# === ROFI/SCRIPTS MAPP√ÅNAK T√ñRL√âSE (rootk√©nt) ===
if [ -d "$SOURCE_DIR" ]; then
    rm -rf "$SOURCE_DIR"
    echo "‚úÖ $SOURCE_DIR mappa √©s tartalma t√∂r√∂lve"
else
    echo "‚Ñπ A $SOURCE_DIR mappa nem l√©tezik, nincs mit t√∂r√∂lni"
fi


echo ""
echo "üéâ Mission Impossibru - CLEAN SKEL EDITION be√°ll√≠tva!"
echo "   ‚úÖ Logol√°s bekapcsolva: ~/.mission_impossibru.log"



#============================================================================
# === V√âGE - MINDEN FELHASZN√ÅL√ì SZ√ÅM√ÅRA ===
# ===========================================================================

echo ""
echo "üéâ MINDEN K√âSZ! üéâ"
echo ""
echo "‚úÖ √ñsszes rendszerszint≈± telep√≠t√©s befejezve"
echo "‚úÖ A jelenlegi felhaszn√°l√≥ megkapta a be√°ll√≠t√°sokat"
echo "‚úÖ Az /etc/skel be√°ll√≠tva - √∫j felhaszn√°l√≥k automatikusan megkapj√°k a konfigur√°ci√≥t"
echo "‚úÖ Nordic t√©ma be√°ll√≠tva mindenhol (GTK, QT, Kvantum, AwesomeWM, LightDM, XFCE)"
echo "‚úÖ Fish shell be√°ll√≠tva alap√©rtelmezettk√©nt (csak root)"
echo "‚úÖ Fontok √°thelyezve rendszerszint≈±v√©: /usr/share/fonts/truetype/custom/"
echo "‚úÖ Rofi szkriptek szimbolikus linkjei l√©trehozva"
echo "‚úÖ Emoji font telep√≠tve (noto-fonts-emoji)"
echo ""
echo "‚ÑπÔ∏è  Fontos:"
echo "   - Minden √∫j felhaszn√°l√≥ automatikusan megkapja a Nordic t√©m√°t"
echo "   - A jelenlegi felhaszn√°l√≥ is megkapta az √∂sszes be√°ll√≠t√°st"
echo "   - A fontok most m√°r rendszerszint≈±ek (/usr/share/fonts/truetype/custom/)"
echo "   - Az emojik most m√°r megjelennek a termin√°lban"
echo ""
echo "√öjraind√≠thatod a rendszert a teljes √©lm√©ny√©rt:"
echo ""
echo ""
echo ""
echo "üìã A teljes napl√≥ itt tal√°lhat√≥: $INSTALL_LOG"
echo
echo
echo "‚ö†Ô∏è  A RENDSZER TAKAR√çT√ÅS√ÅHOZ √âS √ñNMEGSEMMIS√çT√âSHEZ"
echo "   NYOMJ ENTER-T A FOLYTAT√ÅSHOZ..."
echo
read -p ">>> "

# === √ñNMEGSEMMIS√çT≈ê SZKEKVENCIA ===
clear
echo
echo 
echo
echo "‚ïî‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïó"
echo "‚ïë                              ‚ïë"
echo "‚ïë       MISSION IMPOSSIBRU     ‚ïë"
echo "‚ïë                              ‚ïë"
echo "‚ïö‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïù"
echo "‚ïë                              ‚ïë"
echo "‚ïë√ñNMEGSEMMIS√çT≈ê RENDSZER AKT√çV ‚ïë"
echo "‚ïö‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïù"
echo

echo "üö® FIGYELMEZTET√âS: Ez az √ºzenet 5 m√°sodperc m√∫lva √∂nmegsemmis√ºl!"
sleep 2

echo
echo "üí• RENDSZER TAKAR√çT√ÅS KEZDET"
echo "================================"
sleep 1

# Visszasz√°ml√°l√°s dr√°mai effekttel
for i in {5..1}; do
    echo "‚è∞ $i..."
    sleep 1
done

echo
echo "üí£ TAKAR√çT√ÅS FOLYAMATBAN..."
echo "~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~"

echo "üîπ Launcher script elt√°vol√≠t√°sa..."
rm -f "$USER_HOME/awesome-setup-wrapper.sh"
rm -f "$USER_HOME/awesome-setup.sh"

echo "üîπ Autostart f√°jl t√∂rl√©se..."
rm -f "$USER_HOME/.config/autostart/awesome-setup.desktop"

echo "üîπ SKEL mappa takar√≠t√°sa..."
rm -f "/opt/system_setup/awesome-setup-wrapper.sh"
rm -f "/opt/system_setup/awesome-setup.sh"
#rm -f "/etc/skel/awesome-install"
rm -f "/etc/skel/.config/autostart/awesome-setup.desktop"
rm -rf "/root/.config/awesome"
rm -rf "/root/.config/darktable"
rm -f "/root/.config/autostart/awesome-setup.desktop"

echo
echo "üí® F√úST√ñLG≈ê NYOMOK ELT√ÅVOL√çTASA..."
sleep 2

# ASCII "f√ºst" effekt
echo "   .--.   "
echo "  (    )  "
echo " (_)  /   "
echo "   \\ (    "
echo "    ) )   "
echo "   ( (    "
echo "    \\ \\   "
echo "     \\ \\  "
echo "      ) ) "
echo "     / /  "
echo "    ( (   "
echo "     \\ \\  "
echo "      \\ \\ "
echo "       \\_\\"

echo
echo "üéØ F≈ê TELEP√çT≈ê SCRIPT √ñNMEGSEMMIS√çT√âSE..."
rm -f "$USER_HOME/awesome_install"

echo
echo "‚ïî‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïó"
echo "‚ïë          ‚úÖ MISSION COMPLETE           ‚ïë"
echo "‚ïë        üé¨ MINDEN NYOM ELT≈∞NT           ‚ïë"
echo "‚ïö‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïù"
echo
exit 0
